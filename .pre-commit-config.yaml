# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks
fail_fast: true
repos:
  # Ontology Generation & Validation
  - repo: local
    hooks:
      - id: regenerate-artifacts
        name: Regenerate Ontology Artifacts
        entry: bash -c "cd scimantic-core && uv run gen-all"
        language: system
        files: ^scimantic-core/schema/.*\.yaml$
        pass_filenames: false

      - id: validate-ontology
        name: Validate Ontology (SHACL)
        entry: bash -c "cd scimantic-core && uv run pyshacl -s ontology/shacl/scimantic-shapes.ttl ontology/scimantic.ttl"
        language: system
        files: ^scimantic-core/ontology/.*\.ttl$
        pass_filenames: false

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-added-large-files
        exclude: ^(scimantic-core/uv\.lock|uv\.lock)$
      - id: check-toml
      - id: check-yaml
        args:
          - --unsafe
      - id: detect-private-key # Prevents committing private keys
      - id: end-of-file-fixer
      - id: trailing-whitespace

  # Python linting and formatting with ruff
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.10
    hooks:
      - id: ruff
        args:
          - --fix
        files: ^scimantic-core/.*\.py$
        exclude: ^scimantic-core/src/scimantic/models\.py$
      - id: ruff-format
        files: ^scimantic-core/.*\.py$
        exclude: ^scimantic-core/src/scimantic/models\.py$

  # Type checking with mypy (strict mode)
  - repo: local
    hooks:
      - id: mypy
        name: mypy (scimantic-core)
        entry: bash -c 'cd scimantic-core && uv run --extra dev mypy src/scimantic --exclude src/scimantic/models.py'
        language: system
        files: ^scimantic-core/src/scimantic/.*\.py$
        pass_filenames: false
        require_serial: true

  # Test suite with pytest
  - repo: local
    hooks:
      - id: pytest
        name: pytest (scimantic-core)
        entry: bash -c 'cd scimantic-core && uv run --extra dev pytest'
        language: system
        files: ^scimantic-core/(src/scimantic/.*\.py|tests/.*\.py|schema/scimantic\.yaml|ontology/.*\.ttl)$
        pass_filenames: false
        require_serial: true

  # VS Code Extension checks
  - repo: local
    hooks:
      - id: typescript-check-ext
        name: TypeScript check (scimantic-ext)
        entry: bash -c 'cd scimantic-ext && pnpm run check-types'
        language: system
        files: ^scimantic-ext/src/.*\.ts$
        pass_filenames: false
        require_serial: true

      - id: eslint-ext
        name: ESLint (scimantic-ext)
        entry: bash -c 'cd scimantic-ext && pnpm run lint'
        language: system
        files: ^scimantic-ext/src/.*\.ts$
        pass_filenames: false
        require_serial: true

      - id: test-ext
        name: Test (scimantic-ext)
        entry: bash -c 'cd scimantic-ext && CI=true pnpm test'
        language: system
        files: ^scimantic-ext/(src/.*\.ts|package\.json)$
        pass_filenames: false
        require_serial: true



  # Security: Detect secrets and sensitive data
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        exclude: |
          (?x)^(
              .*\.lock$|
              .*pnpm-lock.yaml$|
              .*\.baseline$|
              \.git/.*|
              scimantic-ext/node_modules/.*
          )$

ci:
  autofix_commit_msg: ðŸŽ¨ [pre-commit.ci] Auto format from pre-commit.com hooks
  autoupdate_commit_msg: â¬† [pre-commit.ci] pre-commit autoupdate

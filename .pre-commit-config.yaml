# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks
fail_fast: true
repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: check-added-large-files
        exclude: ^(scimantic-core/uv\.lock|uv\.lock)$
      - id: check-toml
      - id: check-yaml
        args:
          - --unsafe
      - id: detect-private-key # Prevents committing private keys
      - id: end-of-file-fixer
      - id: trailing-whitespace

  # Python linting and formatting with ruff
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.14.10
    hooks:
      - id: ruff
        args:
          - --fix
        files: ^scimantic-core/.*\.py$
      - id: ruff-format
        files: ^scimantic-core/.*\.py$

  # Type checking with mypy (strict mode)
  - repo: local
    hooks:
      - id: mypy
        name: mypy (scimantic-core)
        entry: bash -c 'cd scimantic-core && uv run mypy src/scimantic'
        language: system
        files: ^scimantic-core/src/scimantic/.*\.py$
        pass_filenames: false
        require_serial: true

  # Test suite with pytest
  - repo: local
    hooks:
      - id: pytest
        name: pytest (scimantic-core)
        entry: bash -c 'cd scimantic-core && uv run pytest'
        language: system
        files: ^scimantic-core/(src/scimantic/.*\.py|tests/.*\.py)$
        pass_filenames: false
        require_serial: true

  # VS Code Extension checks
  - repo: local
    hooks:
      - id: typescript-check-ext
        name: TypeScript check (scimantic-ext)
        entry: bash -c 'cd scimantic-ext && pnpm run check-types'
        language: system
        files: ^scimantic-ext/src/.*\.ts$
        pass_filenames: false
        require_serial: true

      - id: eslint-ext
        name: ESLint (scimantic-ext)
        entry: bash -c 'cd scimantic-ext && pnpm run lint'
        language: system
        files: ^scimantic-ext/src/.*\.ts$
        pass_filenames: false
        require_serial: true

  # Ontology Validation
  - repo: local
    hooks:
      - id: validate-ontology
        name: Validate Ontology (Syntax & SHACL)
        entry: bash -c 'cd scimantic-core && uv run python -c "from rdflib import Graph; g=Graph(); g.parse(\"ontology/scimantic.ttl\", format=\"turtle\")" && uv run pyshacl -s ontology/shacl/scimantic-shapes.ttl -df turtle ontology/scimantic.ttl && uv run pyshacl -s ontology/shacl/urref-shapes.ttl -df turtle ontology/scimantic.ttl'
        language: system
        files: ^scimantic-core/ontology/.*\.ttl$
        pass_filenames: false

      - id: generate-ontology-graph
        name: Generate Ontology Graph (Mermaid)
        entry: bash -c 'uv run --with rdflib scripts/visualize_ontology.py'
        language: system
        files: ^scimantic-core/ontology/scimantic\.ttl$|scripts/visualize_ontology\.py$
        pass_filenames: false

  # Security: Detect secrets and sensitive data
  - repo: https://github.com/Yelp/detect-secrets
    rev: v1.5.0
    hooks:
      - id: detect-secrets
        exclude: |
          (?x)^(
              .*\.lock$|
              .*pnpm-lock.yaml$|
              .*\.baseline$|
              \.git/.*|
              scimantic-ext/node_modules/.*
          )$

ci:
  autofix_commit_msg: ðŸŽ¨ [pre-commit.ci] Auto format from pre-commit.com hooks
  autoupdate_commit_msg: â¬† [pre-commit.ci] pre-commit autoupdate

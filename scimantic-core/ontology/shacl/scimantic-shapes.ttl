@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix scimantic: <http://scimantic.io/> .
@prefix prov: <http://www.w3.org/ns/prov#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

# ------------------------------------------------------------------------------
# Hypothesis Validation
# ------------------------------------------------------------------------------

scimantic:HypothesisShape
    a sh:NodeShape ;
    sh:targetClass scimantic:Hypothesis ;
    sh:property [
        sh:path prov:wasDerivedFrom ;
        sh:class scimantic:Evidence ;
        sh:minCount 1 ;
        sh:message "A Hypothesis must be derived from at least one piece of Evidence." ;
    ] .

# ------------------------------------------------------------------------------
# Result Validation
# ------------------------------------------------------------------------------

scimantic:ResultShape
    a sh:NodeShape ;
    sh:targetClass scimantic:Result ;
    sh:property [
        sh:path prov:wasGeneratedBy ;
        sh:class scimantic:Analysis ;
        sh:minCount 1 ;
        sh:message "A Result must be generated by an Analysis activity." ;
    ] .

# ------------------------------------------------------------------------------
# Design Validation
# ------------------------------------------------------------------------------

scimantic:DesignShape
    a sh:NodeShape ;
    sh:targetClass scimantic:Design ;
    sh:property [
        sh:path scimantic:method ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:message "A Design must specify a method." ;
    ] .

# ------------------------------------------------------------------------------
# Nanopublication Validation (Public Scope)
# ------------------------------------------------------------------------------

scimantic:PublicAccessShape
    a sh:NodeShape ;
    sh:targetClass scimantic:Evidence, scimantic:Hypothesis ;
    sh:rule [
        a sh:SPARQLRule ;
        sh:construct """
            PREFIX scimantic: <http://scimantic.io/>
            PREFIX dcterms: <http://purl.org/dc/terms/>
            CONSTRUCT {
                $this scimantic:validationError "Public nanopubs must have a license."
            }
            WHERE {
                $this scimantic:accessLevel ?level .
                FILTER (?level != "local") .
                FILTER NOT EXISTS { $this dcterms:license ?license }
            }
        """ ;
    ] .
